{% from "macros/render_field.jinja" import render_field %}

{% extends "layout.jinja" %}
{% include "includes/navbar.jinja" %}

{% block content %}
<div class="row align-items-center" style="height: 100vh;">
    <div class="mx-auto col-10 col-md-8 col-lg-6">
        <form class="form" action="{{ url_for('api_config.update_server_setting') }}" method="post">

            <h1>HKETA API Server Setting</h1>
            <p class="description">
                Update the API server details here.
            </p>

            <div class="form-group">
                <label for="url" class="form-label">API Server URL</label>
                <input type="url" class="form-control" name="url" placeholder="https://example.com"
                    value="{{ form.url }}" required>
            </div>

            <div class="form-group">
                <label for="username" class="form-label">Username</label>
                <input type="text" class="form-control" name="username">
            </div>

            <div class="form-group">
                <label for="password" class="form-label">Password</label>
                <input type="text" class="form-control" name="password">
            </div>

            <input class="btn btn-primary btn-customized mt-4" id="submit" name="submit" type="submit" value="Submit">
        </form>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
    $('form').submit(function (e) {
        e.preventDefault()

        $.ajax({
            url: $(this).attr('action'),
            type: $(this).attr('method'),
            data: JSON.stringify(formToJson($(this))),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            error: function (xhr, status, error) {
                alertify.error("Something is wrong with the API server.")
                alertify.error($.parseJSON(xhr.responseText).message)
            },
            success: function (res) {
                if (res.success) {
                    alertify.success('Updated.')
                } else {
                    alertify.error(res.message)
                }
            }
        })
    })
</script>
{% endblock script %}